---
title: "Trabajo Practico 2"
format: html
editor: visual
---

```{r, warning=FALSE, message=FALSE}
library(ggdag)
library(dagitty)
library(modelsummary)
```

## Actividad 1.

## Lluvias e inundaciones

El DAG que observan a continuacion representa el modelo causal de un investigador que quiere estudiar el efecto de la **tropicalizacion de los ecosistemas** (que su clima se haya vuelto mas lluvioso y cálido durante todo el año) sobre las **inundaciones** en las ciudades de ese ecosistema. Para eso definio estas variables operacionales en donde:

-   **Lluvias**, es la cantidad de mm acumulados que llovió el año de observación

-   **Vegetación**: es índice de cobertura arbolada de la ciudad observada

-   **Imperm**: se refiere al porcentaje de superficie impermeable de la ciudad estudiada (o lo que es lo mismo el porcentaje de cobertura de su superficie con asfalto o edificaciones)

-   **Actividad**, se refiere a la actividad humana, es un indice compuesto por la densidad poblacional y de industrias en la ciudad

-   **Obra_publica**: es el dinero destinado durante el último año para la infraestructura urbana que evite inundaciones

```{r, warning=FALSE, message=FALSE}
cambio_climatico<-dagitty("dag {
Obra_publica -> Inundaciones
Actividad -> Tropicalizacion
Actividad -> Imperm
Actividad -> Vegetacion
Tropicalizacion -> Lluvias
Tropicalizacion -> Vegetacion
Imperm -> Inundaciones
Lluvias -> Inundaciones
Lluvias -> Vegetacion
Vegetacion -> Imperm
Vegetacion -> Inundaciones
}")

ggdag(cambio_climatico) + theme_dag()+
  geom_dag_node(color ="blue") + 
  geom_dag_text(color = "yellow", size=3.5)+
  geom_dag_edges(size = 1.5)
```

### 1. Caminos de causalidad

¿Cuantos caminos de causalidad abiertos identifica en este DAG? Grafiquelos

```{r}
# escriba el codigo aquí
ggdag_adjustment_set(exposure = "Tropicalizacion", outcome = "Inundaciones",cambio_climatico, node_size = 14) +
  theme(legend.position = "bottom")

ggdag_paths(from = "Tropicalizacion", to= "Inundaciones", cambio_climatico)

cambio_climatico %>% ggdag_paths_fan (from = "Tropicalizacion", to= "Inundaciones", shadow = TRUE, node_size = 18, text_size = 4, spread = 1.5, label_size = text_size, node= TRUE, text_col = "white")
```

*------------------------------------------------------------------------------------------------------*

El DAG contiene 8 caminos que son los siguientes: el primer camino va desde Tropicalización hacia lluvias. Luego, el segundo va desde Tropicalización, a Lluvias, hacia Vegetación, luego a Imperm y finalmente a Inundaciones. El tercer camino va desde Tropicalización, a Lluvias, hacia Vegetación y finalmente hacia Inundaciones. El cuarto camino va desde Tropicalización hacia Vegetación y luego hacia Inundaciones. El quinto va desde Tropicalización, hacia Vegetación, hacia Imperm y finalmente hacia Inundaciones. El sexto camino sale desde actividad hacia Tropicalización y desde actividad hacia Imperm y luego inundaciones. El septimo camino va desde Actividad hacia tropicalización y luego hacia lluvias, luego sale desde actividad hacia vegetación y luego inundaciones. Obras públicas no pertenece a ningún camino.

*-------------------------------------------------------------------------------------------------------*

### 2. Creando un modelo apropiado

Ayude a este investigador a navegar su modelo causal y sugierale el mejor modelo para evaluar la hipotesis de causalidad que se plantea (que la tropicalizacion de los ecosistemas es la responsable de las inundaciones). Si el modelo va a incluir covariables justifique la decision de cual de ellas incluir y por qué.

*------------------------------------------------------------------------------------------------------*

El modelo no debería controlar por Actividad porque es un collider. Luego, con Lluvias y Vegetación si debemos controlar porque es una variable confusora, es decir, el modelo teórico debería incluir:

Inundaciones= β0 ​+ β1 \* Tropicalización + β2​ \* Vegetación + β3 \* Lluvias + ϵ

*-------------------------------------------------------------------------------------------------------*

## Actividad 2.

## Pantallas y obesidad

Un investigador está interesado en el **tiempo que pasan los niños frente a las pantallas** *(exposición)* como un desencadenante de la **obesidad infantil** *(outcome).*

Para ello estudio a 1000 niños de entre 10 y 12 años y armo el dataset que esta a continuación en donde recabo:

-   nivel socioeconomico (como una variable ordinal)

-   educacion (en años)

-   una escala de actividad fisica (que va de -3: sedentarismo total, a +3: estilo de vida muy activo)

-   una escala de autoestima que va de -10 (imagen personal muy negativa) a +10 (imagen personal extremadamente positiva).

-   Horas diarias que pasan frente a una pantalla (de 0 a 24)

-   presencia o no de obesidad.

Para plasmar su marco teórico construyó este **DAG:**

```{r, warning=FALSE, message=FALSE}
# DAG
set.seed(124)
dag <- dagitty("dag {
  A_fisica -> Obesidad
  N_socioeconomico -> T_pantalla
  N_socioeconomico -> Educacion
  T_pantalla -> A_fisica
  T_pantalla -> Autoestima
  Educacion -> A_fisica
  Educacion -> T_pantalla
  Educacion -> Autoestima
  Educacion -> Obesidad
  Obesidad -> Autoestima
}")

ggdag(dag) + theme_dag()+
  geom_dag_node(color ="pink") + 
  geom_dag_text(color = "darkgreen", size=3.5)+
  geom_dag_edges(size = 1.5)

```

Esta es la base de datos con la que vamos a a trabajar

```{r, warning=FALSE, message=FALSE}
library(readr)
obesidad_pantallas <- read_csv("obesidad_pantallas.csv")
```

## Modelos

En funcion de su DAG el investigador construyo los siguientes modelos

```{r}
Model1<- glm(obesidad ~ tiempo_pantalla, data = obesidad_pantallas, family = binomial)
Model2<-glm(obesidad ~ tiempo_pantalla+actividad_fisica, data = obesidad_pantallas, family = binomial)
Model3<-glm(obesidad ~ tiempo_pantalla+autoestima, data = obesidad_pantallas, family = binomial)

models<-list(Model1,Model2,Model3)

modelsummary(models)

modelplot(models, coef_omit = 'Interc')
```

### 1. Interpretación

Ahora que tiene los modelos y esta tabla de resultados escriba un texto breve interpretando cada uno de los modelos y los efectos de las variables incluidas. *Si tiene que hacer algun calculo extra puede hacerlo*

*------------------------------------------------------------------------------------------------------*

Con respecto a los intervalos de confianza, en el modelo 1, la línea no cruza el cero lo cual significa que es significativo. Además, el tiempo en pantalla muestra un coeficiente positivo que puede significar que un mayor tiempo en pantalla incrementa la variable de obesidad.

Por otro lado, en el modelo 2, vemos que el tiempo en pantalla presenta un coeficiente negativo pero, como el intervalo de confianza cruza el cero, la asociación no es significativa. Lo cual nos muestra que cuando agregamos actividad física al modelo, se modifica la significancia de los coeficientes. Además, por el DAG, sabemos que la actividad física es una variable mediadora entre el tiempo en pantalla y la obesidad, por ello, puede que ajustando el modelo con otras variables podamos observar de mejor manera la tendencia de realizar una mayor actividad física.

Finalmente en el modelo 3, al agregar la variable autoestima, que por el DAG sabemos que es collider, se invierten los coeficientes de tiempo en pantalla (es decir, pasan de ser positivos a negativos) y aumenta la incertidumbre ya que su intervalo se vuelve más grande.

*-------------------------------------------------------------------------------------------------------*

### **2. Interpretando el efecto de las pantallas**

Ayude al investigador a resolver su pregunta principal, ¿La exposicion a las pantallas puede causar obesidad? Justifique su respuesta con datos obtenidos de los modelos.

*------------------------------------------------------------------------------------------------------*

*Aquí sus respuestas*

*-------------------------------------------------------------------------------------------------------*

### **3. Seleccionando modelos**

En la salida anterior podemos ver junto con los modelos tambien las métricas de performance de los mismos. ¿Cuál es el mejor modelo?

*------------------------------------------------------------------------------------------------------*

El mejor modelo es el modelo 2, que incluye la variable de actividad física, que según el DAG tiene una relación directa con la obesidad. Además, mejora el ajuste del modelo 1. Aunque el Modelo 3 también incluye una variable relevante como la autoestima, esta es influenciada por la obesidad misma, por lo que podría ser una consecuencia más que una causa.

*-------------------------------------------------------------------------------------------------------*

### 4. Proponiendo nuevas formas de analizar los datos

Hay variables que el investigador no ha incluído en el modelo, ¿ud que piensa?, ¿incluiría alguna de ellas?, ¿podria generar un modelo que a su parecer sea superador? Escribalo, corralo e interpretelo

```{r}
# corra su modelo aqui
Modelo_nuevo <- glm(obesidad ~ tiempo_pantalla + actividad_fisica + nivel_socioeconomico + educacion, 
                    data = obesidad_pantallas, family = binomial)
summary(Modelo_nuevo)
```

*------------------------------------------------------------------------------------------------------*

Podríamos mejorar el análisis incorporando al nivel socioeconómico y a la educación, ya que según el DAG influyen en el tiempo frente a pantallas, la actividad física y la obesidad. Este modelo es más completo porque incluye las variables que influyen directa e indirectamente en la obesidad según el DAG. Al controlar por educación y nivel socioeconómico, podemos ver con mayor claridad el efecto real del tiempo frente a pantallas, sin que esté confundido por otras variables.

*-------------------------------------------------------------------------------------------------------*
